@page "/setting/generate-data"
@using DotNet8.BankingManagementSystem.Frontend.Services
@inject DataGenerationService DataGenerationService

<div class="space-y-8 animate-in fade-in slide-in-from-bottom-2 duration-500">
    <UiPageHeader Title="Data Generation" Subtitle="Generate mock data for testing and development.">
    </UiPageHeader>

    <UiCard Class="max-w-2xl bg-base-100 shadow-xl border border-base-300">
        <div class="p-8 border-b border-base-200 bg-base-200/50">
            <h3 class="text-xl font-black tracking-tight text-base-content">Settings</h3>
            <p class="text-xs font-bold text-base-content/40 uppercase tracking-widest mt-1">Configure Parameters</p>
        </div>
        
        <div class="p-8 space-y-8">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="form-control w-full">
                    <label class="label"><span class="label-text font-bold text-[10px] uppercase tracking-widest opacity-60">Account Count</span></label>
                    <input type="number" class="input input-bordered focus:input-primary transition-all font-mono font-bold" @bind-value="_accountCount" min="1" max="1000" />
                </div>
                
                <div class="form-control w-full opacity-0 pointer-events-none">
                    <label class="label"><span class="label-text font-bold text-[10px] uppercase tracking-widest opacity-60">Spacer</span></label>
                    <div class="input input-bordered"></div>
                </div>

                <div class="form-control w-full">
                    <label class="label"><span class="label-text font-bold text-[10px] uppercase tracking-widest opacity-60">Start Date</span></label>
                    <input type="date" class="input input-bordered focus:input-primary transition-all font-mono font-bold" @bind-value="_fromDate" />
                </div>

                <div class="form-control w-full">
                    <label class="label"><span class="label-text font-bold text-[10px] uppercase tracking-widest opacity-60">End Date</span></label>
                    <input type="date" class="input input-bordered focus:input-primary transition-all font-mono font-bold" @bind-value="_toDate" />
                </div>
            </div>

            <div class="p-6 bg-primary/5 rounded-2xl border border-primary/10 shadow-inner">
                <div class="flex items-start gap-4">
                    <div class="p-2 bg-primary/10 rounded-lg text-primary">
                        <i class="fa-solid fa-microchip"></i>
                    </div>
                    <div class="space-y-2">
                        <p class="text-xs font-black uppercase tracking-widest text-primary/80">Generation Rules</p>
                        <ul class="text-[11px] text-base-content/60 font-medium space-y-1">
                            <li class="flex items-center gap-2"><div class="h-1 w-1 bg-primary rounded-full"></div> Seeds States, Townships, Users, and Accounts.</li>
                            <li class="flex items-center gap-2"><div class="h-1 w-1 bg-primary rounded-full"></div> Creates 5-10 transactions per entity.</li>
                            <li class="flex items-center gap-2"><div class="h-1 w-1 bg-primary rounded-full"></div> Ranges values between 5K and 90M MMK.</li>
                            <li class="flex items-center gap-2"><div class="h-1 w-1 bg-primary rounded-full text-error"></div> <span class="text-error/80">Existing test data will be cleared.</span></li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="flex items-center justify-between pt-4 border-t border-base-200">
                <div class="flex items-center gap-4">
                    <button class="btn btn-primary btn-md shadow-lg shadow-primary/20 px-8" @onclick="GenerateData" disabled="@_isGenerating">
                        @if (_isGenerating)
                        {
                            <span class="loading loading-spinner loading-xs"></span>
                            <span>Generating...</span>
                        }
                        else
                        {
                            <i class="fa-solid fa-play mr-2 text-xs"></i>
                            <span>Generate Data</span>
                        }
                    </button>
                    
                    @if (_percentage > 0)
                    {
                        <div class="radial-progress text-primary text-[10px] font-black" style="--value:@_percentage; --size:2.5rem; --thickness: 4px;" role="progressbar">
                            @_percentage%
                        </div>
                    }
                </div>
            </div>

            @if (_isGenerating || _percentage > 0)
            {
                <div class="space-y-4 animate-in fade-in duration-300">
                    <progress class="progress progress-primary w-full h-3 shadow-inner" value="@_percentage" max="100"></progress>
                    
                    <div class="alert bg-base-200 border-base-300 shadow-sm flex gap-4 p-4">
                        <i class="fa-solid fa-terminal text-primary animate-pulse"></i>
                        <div class="flex flex-col">
                            <span class="text-[10px] font-black uppercase tracking-widest opacity-40">System Log</span>
                            <span class="text-xs font-bold text-base-content opacity-80">@_statusMessage</span>
                        </div>
                    </div>
                </div>
            }
        </div>
    </UiCard>
</div>

@code {
    private int _accountCount = 10;
    private DateTime _fromDate = DateTime.Now.AddMonths(-1);
    private DateTime _toDate = DateTime.Now;
    private bool _isGenerating = false;
    private int _percentage = 0;
    private string _statusMessage = "";

    private async Task GenerateData()
    {
        _isGenerating = true;
        _percentage = 0;
        _statusMessage = "Starting...";

        var progress = new Progress<(int Percentage, string Message)>(p =>
        {
            _percentage = p.Percentage;
            _statusMessage = p.Message;
            StateHasChanged();
        });

        await DataGenerationService.GenerateData(_accountCount, _fromDate, _toDate, progress);

        _isGenerating = false;
        StateHasChanged();
    }
}
